<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一. 闭包是什么 | Carloin</title>
    <meta name="generator" content="VuePress 1.7.1">
    <script>
      var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d683bda0ed58efd27119a068971d5774";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
        </script>
    <link rel="icon" href="/Blog/logo.png">
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/Blog/assets/css/0.styles.69c29f8f.css" as="style"><link rel="preload" href="/Blog/assets/js/app.7485b9fe.js" as="script"><link rel="preload" href="/Blog/assets/js/2.7bf3d873.js" as="script"><link rel="preload" href="/Blog/assets/js/57.209658a2.js" as="script"><link rel="preload" href="/Blog/assets/js/13.84dda851.js" as="script"><link rel="prefetch" href="/Blog/assets/js/10.a3f8b177.js"><link rel="prefetch" href="/Blog/assets/js/100.3c355e07.js"><link rel="prefetch" href="/Blog/assets/js/101.6f9bf60e.js"><link rel="prefetch" href="/Blog/assets/js/102.c74d7c46.js"><link rel="prefetch" href="/Blog/assets/js/103.a9732f85.js"><link rel="prefetch" href="/Blog/assets/js/104.a138b735.js"><link rel="prefetch" href="/Blog/assets/js/105.bc9787a9.js"><link rel="prefetch" href="/Blog/assets/js/106.f055cb55.js"><link rel="prefetch" href="/Blog/assets/js/107.c23e0e74.js"><link rel="prefetch" href="/Blog/assets/js/108.b790b199.js"><link rel="prefetch" href="/Blog/assets/js/109.0a35ce19.js"><link rel="prefetch" href="/Blog/assets/js/11.36fd9f2f.js"><link rel="prefetch" href="/Blog/assets/js/110.ad649fa4.js"><link rel="prefetch" href="/Blog/assets/js/111.2db0b342.js"><link rel="prefetch" href="/Blog/assets/js/112.4edf3889.js"><link rel="prefetch" href="/Blog/assets/js/113.0c44be21.js"><link rel="prefetch" href="/Blog/assets/js/114.3111f614.js"><link rel="prefetch" href="/Blog/assets/js/115.a445fc6a.js"><link rel="prefetch" href="/Blog/assets/js/116.4a9ff271.js"><link rel="prefetch" href="/Blog/assets/js/117.384fd2a8.js"><link rel="prefetch" href="/Blog/assets/js/118.427b6473.js"><link rel="prefetch" href="/Blog/assets/js/119.0caa2ae0.js"><link rel="prefetch" href="/Blog/assets/js/12.4600ed87.js"><link rel="prefetch" href="/Blog/assets/js/120.b3ce9aae.js"><link rel="prefetch" href="/Blog/assets/js/121.e082b92e.js"><link rel="prefetch" href="/Blog/assets/js/14.80ac0ae3.js"><link rel="prefetch" href="/Blog/assets/js/15.50297487.js"><link rel="prefetch" href="/Blog/assets/js/16.79654015.js"><link rel="prefetch" href="/Blog/assets/js/17.1b7dbc3c.js"><link rel="prefetch" href="/Blog/assets/js/18.4a2bd1a6.js"><link rel="prefetch" href="/Blog/assets/js/19.44148c4f.js"><link rel="prefetch" href="/Blog/assets/js/20.8ec66c59.js"><link rel="prefetch" href="/Blog/assets/js/21.6edf0460.js"><link rel="prefetch" href="/Blog/assets/js/22.a585f3e5.js"><link rel="prefetch" href="/Blog/assets/js/23.0aade24f.js"><link rel="prefetch" href="/Blog/assets/js/24.08a48262.js"><link rel="prefetch" href="/Blog/assets/js/25.927dcb46.js"><link rel="prefetch" href="/Blog/assets/js/26.dde0b3d1.js"><link rel="prefetch" href="/Blog/assets/js/27.576de8da.js"><link rel="prefetch" href="/Blog/assets/js/28.5c9be78d.js"><link rel="prefetch" href="/Blog/assets/js/29.4310a23e.js"><link rel="prefetch" href="/Blog/assets/js/3.600e12d8.js"><link rel="prefetch" href="/Blog/assets/js/30.f3b3bf49.js"><link rel="prefetch" href="/Blog/assets/js/31.f9584067.js"><link rel="prefetch" href="/Blog/assets/js/32.a5c9680c.js"><link rel="prefetch" href="/Blog/assets/js/33.cd5b0620.js"><link rel="prefetch" href="/Blog/assets/js/34.edc3fbfc.js"><link rel="prefetch" href="/Blog/assets/js/35.d221dbc7.js"><link rel="prefetch" href="/Blog/assets/js/36.750d08b7.js"><link rel="prefetch" href="/Blog/assets/js/37.34a6ec4e.js"><link rel="prefetch" href="/Blog/assets/js/38.9ef5f605.js"><link rel="prefetch" href="/Blog/assets/js/39.dd2527ea.js"><link rel="prefetch" href="/Blog/assets/js/4.7895f955.js"><link rel="prefetch" href="/Blog/assets/js/40.9d71529c.js"><link rel="prefetch" href="/Blog/assets/js/41.3b067858.js"><link rel="prefetch" href="/Blog/assets/js/42.4d985623.js"><link rel="prefetch" href="/Blog/assets/js/43.3a7f07d4.js"><link rel="prefetch" href="/Blog/assets/js/44.bbd10963.js"><link rel="prefetch" href="/Blog/assets/js/45.e4146c53.js"><link rel="prefetch" href="/Blog/assets/js/46.72376aef.js"><link rel="prefetch" href="/Blog/assets/js/47.0a2ed192.js"><link rel="prefetch" href="/Blog/assets/js/48.1625d4a8.js"><link rel="prefetch" href="/Blog/assets/js/49.8f0ff017.js"><link rel="prefetch" href="/Blog/assets/js/5.b3b1c364.js"><link rel="prefetch" href="/Blog/assets/js/50.a93465af.js"><link rel="prefetch" href="/Blog/assets/js/51.36e051c2.js"><link rel="prefetch" href="/Blog/assets/js/52.cc9857fc.js"><link rel="prefetch" href="/Blog/assets/js/53.cf7a58b1.js"><link rel="prefetch" href="/Blog/assets/js/54.abd22dc8.js"><link rel="prefetch" href="/Blog/assets/js/55.97d047f1.js"><link rel="prefetch" href="/Blog/assets/js/56.4cf4b281.js"><link rel="prefetch" href="/Blog/assets/js/58.c314548d.js"><link rel="prefetch" href="/Blog/assets/js/59.6766bdad.js"><link rel="prefetch" href="/Blog/assets/js/6.8f5e81d0.js"><link rel="prefetch" href="/Blog/assets/js/60.79ee2fcf.js"><link rel="prefetch" href="/Blog/assets/js/61.847748be.js"><link rel="prefetch" href="/Blog/assets/js/62.5b3ede59.js"><link rel="prefetch" href="/Blog/assets/js/63.0b57a93f.js"><link rel="prefetch" href="/Blog/assets/js/64.019a9e02.js"><link rel="prefetch" href="/Blog/assets/js/65.ce660088.js"><link rel="prefetch" href="/Blog/assets/js/66.0a49473a.js"><link rel="prefetch" href="/Blog/assets/js/67.47c8f019.js"><link rel="prefetch" href="/Blog/assets/js/68.cdf84efb.js"><link rel="prefetch" href="/Blog/assets/js/69.8cb3f9fe.js"><link rel="prefetch" href="/Blog/assets/js/7.bc694dcd.js"><link rel="prefetch" href="/Blog/assets/js/70.409c7ceb.js"><link rel="prefetch" href="/Blog/assets/js/71.5304eecb.js"><link rel="prefetch" href="/Blog/assets/js/72.76e51371.js"><link rel="prefetch" href="/Blog/assets/js/73.e7388eb6.js"><link rel="prefetch" href="/Blog/assets/js/74.277cd840.js"><link rel="prefetch" href="/Blog/assets/js/75.798ed40b.js"><link rel="prefetch" href="/Blog/assets/js/76.430464ed.js"><link rel="prefetch" href="/Blog/assets/js/77.89af5ebc.js"><link rel="prefetch" href="/Blog/assets/js/78.bae47a4f.js"><link rel="prefetch" href="/Blog/assets/js/79.86b68b72.js"><link rel="prefetch" href="/Blog/assets/js/8.85624369.js"><link rel="prefetch" href="/Blog/assets/js/80.40e127a3.js"><link rel="prefetch" href="/Blog/assets/js/81.e5b46faa.js"><link rel="prefetch" href="/Blog/assets/js/82.550f7302.js"><link rel="prefetch" href="/Blog/assets/js/83.a8828049.js"><link rel="prefetch" href="/Blog/assets/js/84.9a2d7f6e.js"><link rel="prefetch" href="/Blog/assets/js/85.82ee3df2.js"><link rel="prefetch" href="/Blog/assets/js/86.c5c370d2.js"><link rel="prefetch" href="/Blog/assets/js/87.8b11533b.js"><link rel="prefetch" href="/Blog/assets/js/88.6d3247a5.js"><link rel="prefetch" href="/Blog/assets/js/89.790e11d9.js"><link rel="prefetch" href="/Blog/assets/js/9.9e2d17fa.js"><link rel="prefetch" href="/Blog/assets/js/90.e79e15e2.js"><link rel="prefetch" href="/Blog/assets/js/91.ca8b45be.js"><link rel="prefetch" href="/Blog/assets/js/92.aad1637f.js"><link rel="prefetch" href="/Blog/assets/js/93.4bf59c76.js"><link rel="prefetch" href="/Blog/assets/js/94.b0855c95.js"><link rel="prefetch" href="/Blog/assets/js/95.61121171.js"><link rel="prefetch" href="/Blog/assets/js/96.34f6f793.js"><link rel="prefetch" href="/Blog/assets/js/97.32b98ea8.js"><link rel="prefetch" href="/Blog/assets/js/98.da4557ce.js"><link rel="prefetch" href="/Blog/assets/js/99.fd5efa3b.js">
    <link rel="stylesheet" href="/Blog/assets/css/0.styles.69c29f8f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Blog/" class="home-link router-link-active"><img src="/Blog/logo.png" alt="Carloin" class="logo"> <span class="site-name can-hide">Carloin</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Blog/personal-resume/" class="nav-link">
  个人简历
</a></div> <a href="https://github.com/Carloin/Blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Blog/personal-resume/" class="nav-link">
  个人简历
</a></div> <a href="https://github.com/Carloin/Blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/Blog/about/" class="sidebar-link">前言</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目成果</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blog/javascript/01.closure.html" aria-current="page" class="active sidebar-link">01.闭包究竟是什么</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/javascript/01.closure.html#一-闭包是什么" class="sidebar-link">一. 闭包是什么</a></li><li class="sidebar-sub-header"><a href="/Blog/javascript/01.closure.html#闭包的应用的注意事项" class="sidebar-link">闭包的应用的注意事项</a></li><li class="sidebar-sub-header"><a href="/Blog/javascript/01.closure.html#闭包的应用" class="sidebar-link">闭包的应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/javascript/01.closure.html#_1-模块" class="sidebar-link">1. 模块</a></li><li class="sidebar-sub-header"><a href="/Blog/javascript/01.closure.html#_2-延时器-settimeout-、计数器-setinterval" class="sidebar-link">2. 延时器(setTimeout)、计数器(setInterval)</a></li><li class="sidebar-sub-header"><a href="/Blog/javascript/01.closure.html#_3-监听器" class="sidebar-link">3. 监听器</a></li></ul></li><li class="sidebar-sub-header"><a href="/Blog/javascript/01.closure.html#典型例子" class="sidebar-link">典型例子</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/javascript/01.closure.html#例一" class="sidebar-link">例一</a></li><li class="sidebar-sub-header"><a href="/Blog/javascript/01.closure.html#例二" class="sidebar-link">例二</a></li><li class="sidebar-sub-header"><a href="/Blog/javascript/01.closure.html#例三" class="sidebar-link">例三</a></li></ul></li></ul></li><li><a href="/Blog/javascript/02.encapsulation-new.html" class="sidebar-link">02.原生JS封装_new函数，实现new关键字的功能</a></li><li><a href="/Blog/javascript/03.shake-throttle.html" class="sidebar-link">03.通俗易懂了解函数的防抖和节流</a></li><li><a href="/Blog/javascript/04.this-point.html" class="sidebar-link">04.javaScript中this到底指向谁</a></li><li><a href="/Blog/javascript/05.inherit.html" class="sidebar-link">05.JavaScript中继承的多种方式和优缺点</a></li><li><a href="/Blog/javascript/06.call-apply-bind.html" class="sidebar-link">06.原生JS实现call,apply,bind函数</a></li><li><a href="/Blog/javascript/07.array-deremove.html" class="sidebar-link">07.JavaScript专题之数组去重</a></li><li><a href="/Blog/javascript/08.language-points.html" class="sidebar-link">08.零碎知识点</a></li><li><a href="/Blog/javascript/09.about-object.html" class="sidebar-link">09.关于对象Object</a></li><li><a href="/Blog/javascript/10.symbolic-operation.html" class="sidebar-link">10.关于符号操作</a></li><li><a href="/Blog/javascript/11.about-function.html" class="sidebar-link">11.关于函数function</a></li><li><a href="/Blog/javascript/12.about-class.html" class="sidebar-link">12.关于类class</a></li><li><a href="/Blog/javascript/13.about-Number.html" class="sidebar-link">13.关于数字Number</a></li><li><a href="/Blog/javascript/14.about-Array.html" class="sidebar-link">14.关于数组Array</a></li><li><a href="/Blog/javascript/15.about-String.html" class="sidebar-link">15.关于字符串String</a></li><li><a href="/Blog/javascript/16.about-if-else.html" class="sidebar-link">16.关于if-else</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>剑指offter-JavaScript题解</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web自动化测试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GitHub</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开发规范</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>杂七杂八</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Less</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="一-闭包是什么"><a href="#一-闭包是什么" class="header-anchor">#</a> 一. 闭包是什么</h2> <p>当一个函数能够记住并访问到其所在的词法作用域及作用域链，特别强调是在其定义的作用域外进行的访问，此时该函数和其上层执行上下文共同构成闭包。</p> <p>需要明确的几点：</p> <ol><li>闭包一定是函数对象（wintercn大大的闭包考证）</li> <li>闭包和词法作用域，作用域链，垃圾回收机制息息相关</li> <li>当函数一定是在其定义的作用域外进行的访问时，才产生闭包</li> <li>闭包是由该函数和其上层执行上下文共同构成</li></ol> <p>闭包 = 函数 + 函数能够访问的自由变量</p> <h2 id="闭包的应用的注意事项"><a href="#闭包的应用的注意事项" class="header-anchor">#</a> 闭包的应用的注意事项</h2> <ol><li>内存泄漏（Memory Leak)<div class="language-javascrip line-numbers-mode"><pre class="language-text"><code> function foo() {
     let a = 2;
 
     function bar() {
         console.log( a );
     }
 
     return bar;
 }
 
 let baz = foo();
 
 baz(); //baz指向的对象会永远存在堆内存中
 
 baz = null; //如果baz不再使用，将其指向的对象释放
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li></ol> <h2 id="闭包的应用"><a href="#闭包的应用" class="header-anchor">#</a> 闭包的应用</h2> <h3 id="_1-模块"><a href="#_1-模块" class="header-anchor">#</a> 1. 模块</h3> <p>一个模块应该具有私有属性、私有方法和公有属性、公有方法。</p> <p>而闭包能很好的将模块的公有属性、方法暴露出来。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myModule <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">window<span class="token punctuation">,</span> <span class="token keyword">undefined</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">&quot;echo&quot;</span><span class="token punctuation">;</span>
	
	<span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> name<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		name<span class="token punctuation">,</span>
		getName
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> myModule<span class="token punctuation">.</span>name <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// echo</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> myModule<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// echo</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>&quot;return&quot;关键字将对象引用导出赋值给myModule，从而应用到闭包。</p> <h3 id="_2-延时器-settimeout-、计数器-setinterval"><a href="#_2-延时器-settimeout-、计数器-setinterval" class="header-anchor">#</a> 2. 延时器(setTimeout)、计数器(setInterval)</h3> <p>这里简单写一个常见的关于闭包的面试题。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> i <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token operator">*</span> i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>答案大家都知道：每秒钟输出一个5，一共输出5次。</p> <p>那么如何做到每秒钟输出一个数，以此为0，1，2，3，4呢？</p> <p>我们这里只介绍闭包的解决方法，其他类似块作用域等等的解决方法，我们这里不讨论。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">j</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> j <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token operator">*</span> j<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>	
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>&quot;setTimeout&quot;方法里应用了闭包，使其内部能够记住每次循环所在的词法作用域和作用域链。</p> <p>由于setTimeout中的回调函数会在当前任务队列的尾部进行执行，因此上面第一个例子中每次循环中的setTimeout回调函数记住的i的值是for循环作用域中的值，此时都是5，而第二个例子记住的i的数为setTimeout的父级作用域自执行函数中的j的值，依次为0，1，2，3，4。</p> <h3 id="_3-监听器"><a href="#_3-监听器" class="header-anchor">#</a> 3. 监听器</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> oDiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySeletor</span><span class="token punctuation">(</span><span class="token string">&quot;#div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

oDiv<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> oDiv<span class="token punctuation">.</span>id <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="典型例子"><a href="#典型例子" class="header-anchor">#</a> 典型例子</h2> <h3 id="例一"><a href="#例一" class="header-anchor">#</a> 例一</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">4</span>
<span class="token keyword">const</span> <span class="token function-variable function">addX</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token parameter">n</span> <span class="token operator">=&gt;</span> n <span class="token operator">+</span> x
<span class="token keyword">const</span> addThree <span class="token operator">=</span> <span class="token function">addX</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> d <span class="token operator">=</span> <span class="token function">addThree</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'example partial application'</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token comment">//输出 7</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如果箭头函数让你感到困惑，下面是同样效果：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">4</span>
<span class="token keyword">function</span> <span class="token function">addX</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> n <span class="token operator">+</span> x
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> addThree <span class="token operator">=</span> <span class="token function">addX</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> d <span class="token operator">=</span> <span class="token function">addThree</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'example partial application'</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="例二"><a href="#例二" class="header-anchor">#</a> 例二</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> func<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> sub <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token function">sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>解析：sub 就是 func 这一返回值，func 定义在 fn 内部并且被传递出来了，所以 fn 执行之后垃圾回收器依然没有回收它的内部作用域，因为 func/sub 在使用。sub 依然持有 func 定义时的作用域的引用，而这个引用就叫作闭包。调用 sub 时，它可以访问 func 定义时的词法作用域，因此找到的 a 是 fn 内部的变量 a，它的值是 0。</p> <h3 id="例三"><a href="#例三" class="header-anchor">#</a> 例三</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3</span>
data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3</span>
data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>答案是都是 3，让我们分析一下原因：</p> <p>当执行到 data[0] 函数之前，此时全局上下文的 VO 为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>globalContext <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token constant">VO</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        data<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        i<span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>当执行 data[0] 函数的时候，data[0] 函数的作用域链为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>Context <span class="token operator">=</span> <span class="token punctuation">{</span>
    Scope<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">AO</span><span class="token punctuation">,</span> globalContext<span class="token punctuation">.</span><span class="token constant">VO</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>data[0]Context 的 AO 并没有 i 值，所以会从 globalContext.VO 中查找，i 为 3，所以打印的结果就是 3。</p> <p>data[1] 和 data[2] 是一样的道理。</p> <p>所以让我们改成闭包看看：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0</span>
data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1</span>
data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>当执行到 data[0] 函数之前，此时全局上下文的 VO 为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>globalContext <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token constant">VO</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        data<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        i<span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>跟没改之前一模一样。</p> <p>当执行 data[0] 函数的时候，data[0] 函数的作用域链发生了改变：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>Context <span class="token operator">=</span> <span class="token punctuation">{</span>
    Scope<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">AO</span><span class="token punctuation">,</span> 匿名函数Context<span class="token punctuation">.</span><span class="token constant">AO</span> globalContext<span class="token punctuation">.</span><span class="token constant">VO</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>匿名函数执行上下文的 AO 为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>匿名函数Context <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token constant">AO</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        arguments<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token number">0</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            length<span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        i<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>data[0]Context 的 AO 并没有 i 值，所以会沿着作用域链从匿名函数 Context.AO 中查找，这时候就会找 i 为 0，找到了就不会往 globalContext.VO 中查找了，即使 globalContext.VO 也有 i 的值(值为3)，所以打印的结果就是 0。</p> <p>data[1] 和 data[2] 是一样的道理。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Blog/product/01.diet-health.html" class="prev">
        01.小佳饮食健康健康管理小程序
      </a></span> <span class="next"><a href="/Blog/javascript/02.encapsulation-new.html">
        02.原生JS封装_new函数，实现new关键字的功能
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/Blog/assets/js/app.7485b9fe.js" defer></script><script src="/Blog/assets/js/2.7bf3d873.js" defer></script><script src="/Blog/assets/js/57.209658a2.js" defer></script><script src="/Blog/assets/js/13.84dda851.js" defer></script>
  </body>
</html>
